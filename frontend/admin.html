<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin â€” LUXE STANDARD</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #0f0f0f; --surface: #161616; --surface2: #1e1e1e; --surface3: #252525;
      --border: rgba(255,255,255,0.08); --text: #e4e4e4; --muted: #666;
      --gold: #c9a84c; --gold-dim: rgba(201,168,76,0.15);
      --green: #4caf73; --red: #cf4f4f; --blue: #4c8bcf;
      --font: 'DM Sans', sans-serif; --mono: 'DM Mono', monospace;
      --radius: 6px; --transition: 0.2s ease;
    }
    html, body { height: 100%; }
    body { background: var(--bg); color: var(--text); font-family: var(--font); font-size: 14px; display: flex; flex-direction: column; -webkit-font-smoothing: antialiased; }

    /* Login gate */
    #login-gate {
      min-height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--bg);
    }
    .login-card {
      width: 360px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 2.5rem;
    }
    .login-logo { font-size: 0.75rem; letter-spacing: 0.3em; text-transform: uppercase; color: var(--gold); margin-bottom: 0.5rem; }
    .login-title { font-size: 1.25rem; font-weight: 500; margin-bottom: 2rem; }
    .form-group { margin-bottom: 1rem; }
    label { display: block; font-size: 0.72rem; font-weight: 500; letter-spacing: 0.05em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.4rem; }
    input, select, textarea {
      width: 100%; background: var(--surface2); border: 1px solid var(--border);
      color: var(--text); font-family: var(--font); font-size: 0.9rem;
      padding: 0.6rem 0.9rem; border-radius: 4px; outline: none;
      transition: border-color var(--transition);
    }
    input:focus, select:focus, textarea:focus { border-color: var(--gold); }
    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
      background: var(--gold); color: #000; font-family: var(--font); font-size: 0.8rem;
      font-weight: 600; letter-spacing: 0.05em; padding: 0.65rem 1.25rem;
      border: none; border-radius: 4px; cursor: pointer; transition: all var(--transition); text-decoration: none;
    }
    .btn:hover { opacity: 0.85; }
    .btn-ghost { background: var(--surface3); color: var(--text); }
    .btn-ghost:hover { background: var(--surface2); }
    .btn-danger { background: var(--red); color: var(--text); }
    .btn-full { width: 100%; }
    .btn-sm { padding: 0.4rem 0.75rem; font-size: 0.72rem; }
    .btn-success { background: var(--green); }

    /* Layout */
    #app { display: flex; flex: 1; }

    .sidebar {
      width: 220px; min-width: 220px; background: var(--surface); border-right: 1px solid var(--border);
      display: flex; flex-direction: column; position: sticky; top: 0; height: 100vh; overflow-y: auto;
    }
    .sidebar-logo {
      padding: 1.25rem 1.25rem 0.75rem; font-size: 0.72rem; letter-spacing: 0.25em;
      text-transform: uppercase; color: var(--gold); border-bottom: 1px solid var(--border);
    }
    .sidebar-logo span { display: block; font-size: 0.6rem; color: var(--muted); margin-top: 0.2rem; letter-spacing: 0.1em; }
    .sidebar-nav { padding: 0.75rem 0; flex: 1; }
    .sidebar-link {
      display: flex; align-items: center; gap: 0.75rem;
      padding: 0.6rem 1.25rem; color: var(--muted); cursor: pointer;
      font-size: 0.85rem; font-weight: 500; transition: all var(--transition);
      border: none; background: none; width: 100%; text-align: left;
    }
    .sidebar-link:hover { color: var(--text); background: var(--surface2); }
    .sidebar-link.active { color: var(--gold); background: var(--gold-dim); }
    .sidebar-link .icon { font-size: 1rem; width: 20px; text-align: center; }
    .sidebar-footer { padding: 1rem 1.25rem; border-top: 1px solid var(--border); }
    .sidebar-footer a { color: var(--muted); font-size: 0.78rem; text-decoration: none; }
    .sidebar-footer a:hover { color: var(--gold); }

    .main-content { flex: 1; overflow-y: auto; }
    .topbar {
      padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); display: flex;
      align-items: center; justify-content: space-between; position: sticky; top: 0;
      background: var(--bg); z-index: 10;
    }
    .page-title { font-size: 1.1rem; font-weight: 600; }
    .page-body { padding: 1.5rem; }

    /* Stats grid */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); gap: 1rem; margin-bottom: 2rem; }
    .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.25rem; }
    .stat-label { font-size: 0.68rem; font-weight: 500; letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.4rem; }
    .stat-value { font-size: 1.75rem; font-weight: 600; color: var(--gold); }
    .stat-sub { font-size: 0.75rem; color: var(--muted); margin-top: 0.25rem; }

    /* Tables */
    .table-wrapper { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
    table { width: 100%; border-collapse: collapse; }
    thead th { background: var(--surface2); padding: 0.65rem 1rem; text-align: left; font-size: 0.68rem; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted); }
    tbody td { padding: 0.75rem 1rem; border-top: 1px solid var(--border); font-size: 0.85rem; vertical-align: middle; }
    tbody tr:hover td { background: var(--surface2); }
    .badge { padding: 0.2rem 0.5rem; border-radius: 3px; font-size: 0.65rem; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; }
    .badge-green { background: rgba(76,175,115,0.15); color: var(--green); }
    .badge-yellow { background: rgba(201,168,76,0.15); color: var(--gold); }
    .badge-gray { background: var(--surface3); color: var(--muted); }

    /* Forms */
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .form-full { grid-column: 1/-1; }
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.5rem; }
    .card-title { font-size: 0.85rem; font-weight: 600; margin-bottom: 1rem; color: var(--text); }
    .section-header-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; }

    /* Generate panel */
    .generate-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
    .generate-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.5rem; }
    .type-selector { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; }
    .type-btn { padding: 0.4rem 0.75rem; border: 1px solid var(--border); background: none; color: var(--muted); border-radius: 4px; cursor: pointer; font-size: 0.78rem; font-family: var(--font); transition: all var(--transition); }
    .type-btn.selected { border-color: var(--gold); color: var(--gold); background: var(--gold-dim); }

    /* Toast */
    #toast {
      position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 9999;
      background: var(--surface); border: 1px solid var(--border); border-left: 3px solid var(--gold);
      padding: 0.75rem 1.25rem; font-size: 0.85rem; border-radius: var(--radius);
      transform: translateY(100px); opacity: 0; transition: all 0.3s ease; max-width: 360px;
    }
    #toast.show { transform: translateY(0); opacity: 1; }
    #toast.error { border-left-color: var(--red); }
    #toast.success { border-left-color: var(--green); }

    /* Log output */
    .log { background: #000; border: 1px solid var(--border); border-radius: 4px; padding: 1rem; font-family: var(--mono); font-size: 0.78rem; color: #0f0; max-height: 300px; overflow-y: auto; white-space: pre-wrap; }
    .log .error { color: var(--red); }
    .log .info { color: var(--blue); }
    .log .success { color: var(--green); }

    /* Loading spinner */
    .spinner {
      width: 16px; height: 16px; border: 2px solid rgba(0,0,0,0.2);
      border-top-color: #000; border-radius: 50%; animation: spin 0.7s linear infinite; display: inline-block;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Tabs */
    .tabs { display: flex; gap: 0; border-bottom: 1px solid var(--border); margin-bottom: 1.5rem; }
    .tab { padding: 0.75rem 1.25rem; font-size: 0.82rem; font-weight: 500; color: var(--muted); cursor: pointer; border: none; background: none; font-family: var(--font); border-bottom: 2px solid transparent; transition: all var(--transition); }
    .tab.active { color: var(--gold); border-bottom-color: var(--gold); }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    #login-gate.hidden, #app.hidden { display: none !important; }
    .view { display: none; }
    .view.active { display: block; }
    @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } .generate-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

<!-- Login Gate -->
<div id="login-gate">
  <div class="login-card">
    <div class="login-logo">Luxe Standard</div>
    <div class="login-title">Admin Panel</div>
    <div class="form-group">
      <label for="secret-input">Admin Secret</label>
      <input type="password" id="secret-input" placeholder="Enter your ADMIN_SECRETâ€¦">
    </div>
    <button class="btn btn-full" id="login-btn">Access Dashboard</button>
    <div id="login-error" style="color:var(--red);font-size:0.78rem;margin-top:0.75rem;display:none">Invalid secret. Check wrangler.toml.</div>
  </div>
</div>

<!-- App -->
<div id="app" class="hidden">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      LUXE STANDARD
      <span>Admin Panel</span>
    </div>
    <nav class="sidebar-nav">
      <button class="sidebar-link active" data-view="dashboard"><span class="icon">ðŸ“Š</span>Dashboard</button>
      <button class="sidebar-link" data-view="generate"><span class="icon">âœ¨</span>Generate Content</button>
      <button class="sidebar-link" data-view="articles"><span class="icon">ðŸ“°</span>Articles</button>
      <button class="sidebar-link" data-view="links"><span class="icon">ðŸ”—</span>Affiliate Links</button>
    </nav>
    <div class="sidebar-footer">
      <a href="/" target="_blank">â†— View Site</a>
    </div>
  </aside>

  <!-- Main -->
  <div class="main-content">
    <!-- Dashboard -->
    <div class="view active" id="view-dashboard">
      <div class="topbar">
        <div class="page-title">Dashboard</div>
        <button class="btn btn-ghost btn-sm" id="refresh-stats">â†» Refresh</button>
      </div>
      <div class="page-body">
        <div class="stats-grid" id="stats-grid">
          <div class="stat-card"><div class="stat-label">Total Articles</div><div class="stat-value" id="stat-total">â€”</div></div>
          <div class="stat-card"><div class="stat-label">Published</div><div class="stat-value" id="stat-published" style="color:var(--green)">â€”</div></div>
          <div class="stat-card"><div class="stat-label">Drafts</div><div class="stat-value" id="stat-drafts" style="color:var(--gold)">â€”</div></div>
          <div class="stat-card"><div class="stat-label">Affiliate Links</div><div class="stat-value" id="stat-links">â€”</div></div>
        </div>
        <div style="margin-bottom:1.5rem">
          <div class="section-header-row">
            <div style="font-size:0.85rem;font-weight:600">Recent Articles</div>
          </div>
          <div class="table-wrapper">
            <table>
              <thead><tr><th>Title</th><th>Status</th><th>Created</th><th>Actions</th></tr></thead>
              <tbody id="recent-articles-table"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Generate Content -->
    <div class="view" id="view-generate">
      <div class="topbar">
        <div class="page-title">Generate Content</div>
      </div>
      <div class="page-body">
        <div class="generate-grid">
          <!-- Single generate -->
          <div class="generate-card">
            <div class="card-title">âœ¨ Generate Single Article</div>
            <div class="form-group">
              <label>Select Affiliate Link</label>
              <select id="gen-link-select"><option value="">Loading linksâ€¦</option></select>
            </div>
            <div class="form-group">
              <label>Article Type</label>
              <div class="type-selector">
                <button class="type-btn selected" data-type="spotlight">Spotlight</button>
                <button class="type-btn" data-type="comparison">Comparison</button>
                <button class="type-btn" data-type="lifestyle">Lifestyle</button>
              </div>
            </div>
            <div class="form-group" style="display:flex;align-items:center;gap:.75rem">
              <input type="checkbox" id="gen-auto-publish" style="width:auto">
              <label for="gen-auto-publish" style="text-transform:none;letter-spacing:0;font-size:0.85rem;margin:0">Auto-publish after generation</label>
            </div>
            <button class="btn" id="gen-single-btn">Generate Article</button>
          </div>

          <!-- Batch generate -->
          <div class="generate-card">
            <div class="card-title">âš¡ Batch Generate</div>
            <div class="form-group">
              <label>Link IDs (comma separated)</label>
              <input type="text" id="gen-batch-ids" placeholder="1, 2, 3, 4, 5">
            </div>
            <div class="form-group">
              <label>Article Type</label>
              <select id="gen-batch-type">
                <option value="spotlight">Spotlight</option>
                <option value="comparison">Comparison</option>
                <option value="lifestyle">Lifestyle</option>
              </select>
            </div>
            <div class="form-group" style="display:flex;align-items:center;gap:.75rem">
              <input type="checkbox" id="gen-batch-publish" style="width:auto">
              <label for="gen-batch-publish" style="text-transform:none;letter-spacing:0;font-size:0.85rem;margin:0">Auto-publish all</label>
            </div>
            <button class="btn" id="gen-batch-btn">Run Batch</button>
          </div>
        </div>

        <!-- Generation log -->
        <div style="margin-top:1.5rem">
          <div class="card-title">Generation Log</div>
          <div class="log" id="gen-log">Ready. Select a link and click Generate.
</div>
        </div>
      </div>
    </div>

    <!-- Articles -->
    <div class="view" id="view-articles">
      <div class="topbar">
        <div class="page-title">Articles</div>
        <div style="display:flex;gap:.5rem">
          <select id="article-filter-status" style="width:auto;padding:.4rem .75rem">
            <option value="">All statuses</option>
            <option value="published">Published</option>
            <option value="draft">Draft</option>
          </select>
          <button class="btn btn-ghost btn-sm" id="refresh-articles">â†»</button>
        </div>
      </div>
      <div class="page-body">
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Title</th><th>Type</th><th>Status</th><th>Words</th><th>Created</th><th>Actions</th></tr></thead>
            <tbody id="articles-table"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Affiliate Links -->
    <div class="view" id="view-links">
      <div class="topbar">
        <div class="page-title">Affiliate Links</div>
        <button class="btn btn-sm" id="show-add-link">+ Add Link</button>
      </div>
      <div class="page-body">
        <!-- Add link form -->
        <div id="add-link-form" style="display:none;margin-bottom:1.5rem">
          <div class="card">
            <div class="card-title">Add Affiliate Link</div>
            <div class="form-grid">
              <div class="form-group"><label>Product Name *</label><input type="text" id="link-name" placeholder="Montblanc MeisterstÃ¼ck Briefcase"></div>
              <div class="form-group"><label>Brand</label><input type="text" id="link-brand" placeholder="Montblanc"></div>
              <div class="form-group form-full"><label>Product Description</label><textarea id="link-desc" rows="2" placeholder="Brief description of the productâ€¦"></textarea></div>
              <div class="form-group"><label>Price (USD)</label><input type="number" id="link-price-usd" placeholder="1850"></div>
              <div class="form-group"><label>Price Display</label><input type="text" id="link-price" placeholder="$1,850"></div>
              <div class="form-group form-full"><label>Affiliate URL *</label><input type="url" id="link-url" placeholder="https://shareasale.com/r.cfm?â€¦"></div>
              <div class="form-group">
                <label>Network</label>
                <select id="link-network">
                  <option value="shareasale">ShareASale</option>
                  <option value="impact">Impact.com</option>
                  <option value="direct">Direct</option>
                  <option value="cj">Commission Junction</option>
                  <option value="awin">Awin</option>
                </select>
              </div>
              <div class="form-group">
                <label>Category *</label>
                <select id="link-category"><option value="">Loadingâ€¦</option></select>
              </div>
              <div class="form-group"><label>Tags (comma separated)</label><input type="text" id="link-tags" placeholder="watch, luxury, executive"></div>
              <div class="form-group" style="display:flex;align-items:center;gap:.75rem;padding-top:1.25rem">
                <input type="checkbox" id="link-featured" style="width:auto">
                <label for="link-featured" style="text-transform:none;letter-spacing:0;font-size:0.85rem;margin:0">Featured product</label>
              </div>
            </div>
            <div style="display:flex;gap:.75rem;margin-top:1rem">
              <button class="btn" id="save-link-btn">Save Link</button>
              <button class="btn btn-ghost" id="cancel-link-btn">Cancel</button>
            </div>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead><tr><th>Product</th><th>Brand</th><th>Price</th><th>Network</th><th>Category</th><th>Articles</th><th>Actions</th></tr></thead>
            <tbody id="links-table"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
  const WORKER_URL = ''; // Empty = same origin (Cloudflare Pages + Worker via routes)
  const API = `${WORKER_URL}/api`;
  let ADMIN_SECRET = '';

  const toast = document.getElementById('toast');
  function showToast(msg, type = 'info') {
    toast.textContent = msg;
    toast.className = `show ${type}`;
    clearTimeout(toast._t);
    toast._t = setTimeout(() => toast.className = '', 3500);
  }

  function headers() {
    return { 'Content-Type': 'application/json', 'X-Admin-Secret': ADMIN_SECRET };
  }

  async function api(path, opts = {}) {
    const r = await fetch(`${API}${path}`, { headers: headers(), ...opts });
    if (r.status === 401) throw new Error('Unauthorized â€” check your secret');
    if (!r.ok) {
      const e = await r.json().catch(() => ({ error: r.statusText }));
      throw new Error(e.error || r.statusText);
    }
    return r.json();
  }

  // â”€â”€â”€ Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('login-btn').addEventListener('click', async () => {
    const secret = document.getElementById('secret-input').value.trim();
    if (!secret) return;
    try {
      const res = await fetch(`${API}/admin/stats`, { headers: { 'X-Admin-Secret': secret } });
      if (res.status === 401) {
        document.getElementById('login-error').style.display = 'block';
        return;
      }
      ADMIN_SECRET = secret;
      document.getElementById('login-gate').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      init();
    } catch(e) {
      document.getElementById('login-error').style.display = 'block';
    }
  });
  document.getElementById('secret-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') document.getElementById('login-btn').click();
  });

  // â”€â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.querySelectorAll('.sidebar-link[data-view]').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.sidebar-link').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(`view-${btn.dataset.view}`).classList.add('active');
      if (btn.dataset.view === 'dashboard') loadStats();
      if (btn.dataset.view === 'articles') loadArticles();
      if (btn.dataset.view === 'links') loadLinks();
      if (btn.dataset.view === 'generate') loadLinksForSelect();
    });
  });

  // â”€â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadStats() {
    try {
      const data = await api('/admin/stats');
      document.getElementById('stat-total').textContent = data.articles?.total || 0;
      document.getElementById('stat-published').textContent = data.articles?.published || 0;
      document.getElementById('stat-drafts').textContent = data.articles?.drafts || 0;
      document.getElementById('stat-links').textContent = data.affiliate_links?.total || 0;

      const tbody = document.getElementById('recent-articles-table');
      tbody.innerHTML = (data.recent_articles || []).map(a => `
        <tr>
          <td><a href="/articles/${a.slug}" target="_blank" style="color:var(--gold);text-decoration:none">${a.title || '(untitled)'}</a></td>
          <td><span class="badge ${a.status === 'published' ? 'badge-green' : 'badge-yellow'}">${a.status}</span></td>
          <td style="color:var(--muted)">${a.created_at ? new Date(a.created_at).toLocaleDateString() : ''}</td>
          <td>
            ${a.status === 'draft'
              ? `<button class="btn btn-sm btn-success" onclick="publishArticle(${a.id})">Publish</button>`
              : `<button class="btn btn-sm btn-ghost" onclick="unpublishArticle(${a.id})">Unpublish</button>`}
            <button class="btn btn-sm btn-danger" style="margin-left:4px" onclick="deleteArticle(${a.id})">Delete</button>
          </td>
        </tr>`).join('') || '<tr><td colspan="4" style="text-align:center;color:var(--muted);padding:2rem">No articles yet.</td></tr>';
    } catch(e) { showToast(e.message, 'error'); }
  }

  document.getElementById('refresh-stats').addEventListener('click', loadStats);

  // â”€â”€â”€ Articles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadArticles() {
    const tbody = document.getElementById('articles-table');
    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:2rem;color:var(--muted)">Loadingâ€¦</td></tr>';
    try {
      // Use public API with no filter to load all, admin would need its own list endpoint
      const data = await fetch(`${API}/articles?limit=50`).then(r => r.json());
      const articles = data.articles || [];
      tbody.innerHTML = articles.map(a => `
        <tr>
          <td><a href="/articles/${a.slug}" target="_blank" style="color:var(--gold);text-decoration:none">${a.title}</a></td>
          <td><span class="badge badge-gray">${a.article_type}</span></td>
          <td><span class="badge ${a.status === 'published' ? 'badge-green' : 'badge-yellow'}">${a.status || 'published'}</span></td>
          <td style="color:var(--muted)">${a.word_count || 'â€”'}</td>
          <td style="color:var(--muted)">${a.published_at ? new Date(a.published_at).toLocaleDateString() : 'â€”'}</td>
          <td style="display:flex;gap:4px">
            ${!a.status || a.status === 'draft'
              ? `<button class="btn btn-sm btn-success" onclick="publishArticle(${a.id})">Publish</button>`
              : `<button class="btn btn-sm btn-ghost" onclick="unpublishArticle(${a.id})">Unpublish</button>`}
            <button class="btn btn-sm btn-danger" onclick="deleteArticle(${a.id})">Delete</button>
          </td>
        </tr>`).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:2rem">No articles yet.</td></tr>';
    } catch(e) { showToast(e.message, 'error'); tbody.innerHTML = '<tr><td colspan="6" style="color:var(--red)">Error loading articles.</td></tr>'; }
  }

  document.getElementById('refresh-articles').addEventListener('click', loadArticles);

  async function publishArticle(id) {
    try {
      await api(`/admin/articles/${id}/publish`, { method: 'PUT' });
      showToast('Article published!', 'success');
      loadStats(); loadArticles();
    } catch(e) { showToast(e.message, 'error'); }
  }

  async function unpublishArticle(id) {
    try {
      await api(`/admin/articles/${id}/unpublish`, { method: 'PUT' });
      showToast('Article unpublished.', 'info');
      loadStats(); loadArticles();
    } catch(e) { showToast(e.message, 'error'); }
  }

  async function deleteArticle(id) {
    if (!confirm('Delete this article? This cannot be undone.')) return;
    try {
      await api(`/admin/articles/${id}`, { method: 'DELETE' });
      showToast('Deleted.', 'success');
      loadStats(); loadArticles();
    } catch(e) { showToast(e.message, 'error'); }
  }

  // â”€â”€â”€ Affiliate Links â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let categories = [];

  async function loadLinks() {
    const tbody = document.getElementById('links-table');
    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:2rem;color:var(--muted)">Loadingâ€¦</td></tr>';
    try {
      const links = await api('/admin/links');
      tbody.innerHTML = links.map(l => `
        <tr>
          <td>${l.product_name}</td>
          <td style="color:var(--muted)">${l.brand || 'â€”'}</td>
          <td style="color:var(--gold)">${l.price_display || 'â€”'}</td>
          <td><span class="badge badge-gray">${l.network || 'shareasale'}</span></td>
          <td style="color:var(--muted)">${l.category_name || 'â€”'}</td>
          <td style="color:var(--muted)">${l.article_count || 0}</td>
          <td style="display:flex;gap:4px">
            <button class="btn btn-sm" onclick="generateFromLink(${l.id}, '${l.product_name.replace(/'/g,"\\'")}')">âœ¨ Gen</button>
            <button class="btn btn-sm btn-danger" onclick="deleteLink(${l.id})">Del</button>
          </td>
        </tr>`).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--muted);padding:2rem">No links yet. Add your first affiliate link above.</td></tr>';
    } catch(e) { showToast(e.message, 'error'); }
  }

  async function deleteLink(id) {
    if (!confirm('Delete this affiliate link?')) return;
    try {
      await api(`/admin/links/${id}`, { method: 'DELETE' });
      showToast('Link deleted.', 'success');
      loadLinks();
    } catch(e) { showToast(e.message, 'error'); }
  }

  // Add link form
  document.getElementById('show-add-link').addEventListener('click', () => {
    document.getElementById('add-link-form').style.display = 'block';
  });
  document.getElementById('cancel-link-btn').addEventListener('click', () => {
    document.getElementById('add-link-form').style.display = 'none';
  });

  async function loadCategories() {
    categories = await fetch(`${API}/categories`).then(r => r.json()).catch(() => []);
    const opts = categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
    document.getElementById('link-category').innerHTML = opts;
  }

  document.getElementById('save-link-btn').addEventListener('click', async () => {
    const name = document.getElementById('link-name').value.trim();
    const url = document.getElementById('link-url').value.trim();
    const catId = document.getElementById('link-category').value;

    if (!name || !url || !catId) { showToast('Name, URL, and Category are required.', 'error'); return; }

    const tags = document.getElementById('link-tags').value.split(',').map(t => t.trim()).filter(Boolean);

    try {
      await api('/admin/links', {
        method: 'POST',
        body: JSON.stringify({
          product_name: name,
          product_description: document.getElementById('link-desc').value,
          price_usd: parseFloat(document.getElementById('link-price-usd').value) || null,
          price_display: document.getElementById('link-price').value,
          brand: document.getElementById('link-brand').value,
          affiliate_url: url,
          network: document.getElementById('link-network').value,
          category_id: parseInt(catId),
          tags,
          is_featured: document.getElementById('link-featured').checked,
        }),
      });
      showToast('Affiliate link added!', 'success');
      document.getElementById('add-link-form').style.display = 'none';
      // Reset form
      ['link-name','link-brand','link-desc','link-price-usd','link-price','link-url','link-tags'].forEach(id => document.getElementById(id).value = '');
      document.getElementById('link-featured').checked = false;
      loadLinks();
      loadLinksForSelect();
    } catch(e) { showToast(e.message, 'error'); }
  });

  // â”€â”€â”€ Generate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let selectedType = 'spotlight';

  document.querySelectorAll('.type-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      selectedType = btn.dataset.type;
    });
  });

  async function loadLinksForSelect() {
    try {
      const links = await api('/admin/links');
      document.getElementById('gen-link-select').innerHTML =
        '<option value="">â€” Select a link â€”</option>' +
        links.map(l => `<option value="${l.id}">[${l.category_name}] ${l.product_name} â€” ${l.price_display || 'N/A'}</option>`).join('');
    } catch(e) {}
  }

  function log(msg, type = '') {
    const el = document.getElementById('gen-log');
    const line = `[${new Date().toLocaleTimeString()}] ${msg}\n`;
    el.insertAdjacentHTML('beforeend', type ? `<span class="${type}">${line}</span>` : line);
    el.scrollTop = el.scrollHeight;
  }

  document.getElementById('gen-single-btn').addEventListener('click', async () => {
    const linkId = parseInt(document.getElementById('gen-link-select').value);
    if (!linkId) { showToast('Select a link first.', 'error'); return; }
    const autoPublish = document.getElementById('gen-auto-publish').checked;

    const btn = document.getElementById('gen-single-btn');
    btn.innerHTML = '<span class="spinner"></span> Generatingâ€¦';
    btn.disabled = true;

    log(`Generating ${selectedType} article for link ID ${linkId}â€¦`, 'info');
    try {
      const res = await api('/admin/generate', {
        method: 'POST',
        body: JSON.stringify({ link_id: linkId, article_type: selectedType, auto_publish: autoPublish }),
      });
      log(`âœ“ Article generated! Slug: ${res.slug} | ID: ${res.id}`, 'success');
      showToast('Article generated!', 'success');
    } catch(e) {
      log(`âœ— Error: ${e.message}`, 'error');
      showToast(e.message, 'error');
    } finally {
      btn.innerHTML = 'Generate Article';
      btn.disabled = false;
    }
  });

  document.getElementById('gen-batch-btn').addEventListener('click', async () => {
    const idsRaw = document.getElementById('gen-batch-ids').value;
    const ids = idsRaw.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
    if (!ids.length) { showToast('Enter at least one link ID.', 'error'); return; }

    const type = document.getElementById('gen-batch-type').value;
    const autoPublish = document.getElementById('gen-batch-publish').checked;

    const btn = document.getElementById('gen-batch-btn');
    btn.innerHTML = '<span class="spinner"></span> Running batchâ€¦';
    btn.disabled = true;

    log(`Starting batch generation for ${ids.length} links: ${ids.join(', ')}`, 'info');
    try {
      const res = await api('/admin/generate/batch', {
        method: 'POST',
        body: JSON.stringify({ link_ids: ids, article_type: type, auto_publish: autoPublish }),
      });
      res.generated.forEach(r => log(`âœ“ Generated: ${r.slug}`, 'success'));
      res.errors.forEach(e => log(`âœ— Link ${e.id}: ${e.error}`, 'error'));
      showToast(`Done! ${res.generated.length} generated, ${res.errors.length} errors.`, 'success');
    } catch(e) {
      log(`âœ— Batch error: ${e.message}`, 'error');
      showToast(e.message, 'error');
    } finally {
      btn.innerHTML = 'Run Batch';
      btn.disabled = false;
    }
  });

  function generateFromLink(id, name) {
    // Switch to generate view and pre-select link
    document.querySelectorAll('.sidebar-link').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.querySelector('[data-view="generate"]').classList.add('active');
    document.getElementById('view-generate').classList.add('active');
    loadLinksForSelect().then(() => {
      document.getElementById('gen-link-select').value = id;
    });
  }

  // â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function init() {
    await Promise.all([loadStats(), loadCategories()]);
  }

  // Expose for inline event handlers
  window.publishArticle = publishArticle;
  window.unpublishArticle = unpublishArticle;
  window.deleteArticle = deleteArticle;
  window.deleteLink = deleteLink;
  window.generateFromLink = generateFromLink;
</script>
</body>
</html>
